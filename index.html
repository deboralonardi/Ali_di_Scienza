<!DOCTYPE html>
<html lang="it" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PCTO AeroPhysics â€“ Sito Vetrina Editabile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .space-bg { background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%); }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .neon-glow { box-shadow: 0 0 20px rgba(102,126,234,.5); }
    .hover-lift { transition: transform .3s ease, box-shadow .3s ease; }
    .hover-lift:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,.2); }
    .page { display: none; }
    .page.active { display: block; }
    .nav-link { transition: all .3s ease; position: relative; }
    .nav-link.active { color: #60a5fa; }
    .nav-link.active::after { content: ""; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: linear-gradient(90deg,#60a5fa,#a78bfa); }
    .floating-animation { animation: float 6s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform: translateY(0)} 50%{transform: translateY(-20px)} }
    .pulse-animation { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }
    .mobile-menu { display: none; }
    .mobile-menu.open { display: block; }
    @media (max-width:768px){ .desktop-menu{display:none} .mobile-menu-btn{display:block} }
    @media (min-width:769px){ .mobile-menu-btn{display:none} }
    .file-upload-area{ border:2px dashed #60a5fa; transition: all .3s ease; }
    .file-upload-area:hover{ border-color:#a78bfa; background-color: rgba(96,165,250,.1); }

    /* Modifica in-place: solo gli elementi con questa classe diventano editabili */
    .editing-enabled { position: relative; cursor: text; }
    .editing-enabled:hover { background-color: rgba(59,130,246,.08); border-radius: 4px; outline: 1px dashed rgba(59,130,246,.5); }
    .editing-enabled[contenteditable="true"] { background-color: rgba(59,130,246,.12); outline: 2px solid #3b82f6; border-radius: 4px; }
    .editing-enabled[contenteditable="true"]:focus { outline: 2px solid #10b981; background-color: rgba(16,185,129,.10); }

    /* Banner edit */
    .edit-banner { position: fixed; top: 1rem; left: 1rem; z-index: 50; }

    /* Controls visible only in editing mode */
    .editing-controls { display: none; }
    .editing-controls.visible { display: block; }
    .material-link-input { background-color: rgba(255,255,255,0.04); border: 1px dashed rgba(255,255,255,0.08); color: #fff; padding: .4rem .6rem; border-radius: .5rem; width:100%; }
    .material-controls { margin-top: .6rem; display:flex; gap:.5rem; align-items:center; }
    .material-controls .btn { padding:.4rem .6rem; border-radius:.4rem; font-size:.875rem; }
    .material-hint { font-size:.75rem; color:#9ca3af; }
    .material-download { display:inline-block; text-decoration:none; }
  </style>
</head>
<body class="h-full space-bg text-white">
  <!-- Banner modalitÃ  -->
  <div id="editBanner" class="edit-banner bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg text-sm hidden">
    <div class="flex items-center space-x-2">
      <span>âœï¸</span>
      <span>ModalitÃ  Editing Attiva â€“ clicca sui testi per modificarli</span>
    </div>
  </div>

  <!-- Header -->
  <header class="bg-black/50 backdrop-blur-md sticky top-0 z-40 border-b border-blue-500/30">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <nav class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <!-- Logo -->
          <svg class="w-10 h-10 text-blue-400" viewBox="0 0 100 100" fill="currentColor" aria-hidden="true">
            <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M30 50 L50 30 L70 50 L50 70 Z" fill="currentColor" opacity="0.7"/>
            <circle cx="50" cy="50" r="8" fill="currentColor"/>
            <path d="M50 20 L50 80 M20 50 L80 50" stroke="currentColor" stroke-width="1" opacity=".5"/>
          </svg>
          <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent editing-enabled" data-key="brand-title">Ali di Scienza</h1>
        </div>

        <!-- Menu Desktop -->
        <div class="desktop-menu flex space-x-6">
          <a href="#home" class="nav-link text-gray-300 hover:text-blue-400" data-page="home">Progetto</a>
          <a href="#materials" class="nav-link text-gray-300 hover:text-blue-400" data-page="materials">Materiali</a>
          <a href="#application" class="nav-link text-gray-300 hover:text-blue-400" data-page="application">Candidature</a>
          <a href="#program" class="nav-link text-gray-300 hover:text-blue-400" data-page="program">Programma</a>
          <a href="#media" class="nav-link text-gray-300 hover:text-blue-400" data-page="media">Media</a>
          <a href="#communications" class="nav-link text-gray-300 hover:text-blue-400" data-page="communications">Comunicazioni</a>
          <a href="#webmaster" class="nav-link text-gray-300 hover:text-blue-400" data-page="webmaster">Webmaster</a>
        </div>

        <!-- Menu Mobile -->
        <button class="mobile-menu-btn text-gray-300 hover:text-blue-400" id="mobileMenuBtn" aria-label="Apri menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </nav>

      <div class="mobile-menu mt-4 pb-4" id="mobileMenu" aria-hidden="true">
        <div class="flex flex-col space-y-3">
          <a href="#home" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="home">Progetto</a>
          <a href="#materials" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="materials">Materiali</a>
          <a href="#application" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="application">Candidature</a>
          <a href="#program" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="program">Programma</a>
          <a href="#media" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="media">Media</a>
          <a href="#communications" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="communications">Comunicazioni</a>
          <a href="#webmaster" class="nav-link text-gray-300 hover:text-blue-400 py-2" data-page="webmaster">Webmaster</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Toolbar azioni: rimane nel DOM ma la mostriamo SOLO nella pagina "webmaster" -->
  <div id="toolbarActions" class="sticky top-16 z-30 bg-black/30 backdrop-blur-md border-y border-blue-500/20">
    <div class="max-w-7xl mx-auto px-6 py-3 flex flex-wrap gap-2 items-center">
      <button id="toggleEdit" class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-700">âœï¸ ModalitÃ  editing</button>
      <button id="saveEdits" class="px-4 py-2 rounded bg-emerald-600 hover:bg-emerald-700">ğŸ’¾ Salva (local)</button>
      <button id="clearEdits" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700">ğŸ§¹ Ripristina</button>
      <span class="text-xs text-gray-300">(Il salvataggio resta nel tuo browser)</span>
    </div>
  </div>

  <main class="min-h-full">
    <!-- ... tutte le sezioni come nell'ultima versione ... -->
    <!-- APPLICATION (CANDIDATURE) - restored form -->
    <section id="application" class="page">
      <section class="py-20 px-6">
        <div class="max-w-4xl mx-auto">
          <div class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent editing-enabled" data-key="app-title">ğŸ¯ Candidature PCTO</h1>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto editing-enabled" data-key="app-subtitle">Compila il modulo per candidare la tua scuola al progetto "Ali di Scienza".</p>
          </div>

          <div class="bg-gradient-to-br from-gray-800 to-gray-900 p-8 rounded-2xl border border-purple-500/30">
            <form id="applicationForm" class="space-y-6">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label for="schoolName" class="block text-sm font-medium text-gray-300 mb-2">ğŸ« Nome Istituto *</label>
                  <input type="text" id="schoolName" name="schoolName" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                </div>
                <div>
                  <label for="schoolType" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“š Tipo di Scuola *</label>
                  <select id="schoolType" name="schoolType" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="">Seleziona tipo</option>
                    <option value="liceo-scientifico">Liceo Scientifico</option>
                    <option value="istituto-tecnico">Istituto Tecnico</option>
                    <option value="istituto-professionale">Istituto Professionale</option>
                    <option value="altro">Altro</option>
                  </select>
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label for="city" class="block text-sm font-medium text-gray-300 mb-2">ğŸŒ CittÃ  *</label>
                  <input type="text" id="city" name="city" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                </div>
                <div>
                  <label for="province" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“ Provincia *</label>
                  <input type="text" id="province" name="province" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                </div>
              </div>

              <div class="border-t border-gray-600 pt-6">
                <h3 class="text-xl font-bold text-white mb-4 editing-enabled" data-key="ref-title">ğŸ‘¨ğŸ« Referente del Progetto</h3>
                <div class="grid md:grid-cols-2 gap-6">
                  <div>
                    <label for="contactName" class="block text-sm font-medium text-gray-300 mb-2">ğŸ‘¤ Nome e Cognome *</label>
                    <input type="text" id="contactName" name="contactName" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                  </div>
                  <div>
                    <label for="contactRole" class="block text-sm font-medium text-gray-300 mb-2">ğŸ’¼ Ruolo *</label>
                    <input type="text" id="contactRole" name="contactRole" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                  </div>
                </div>
                <div class="grid md:grid-cols-2 gap-6 mt-6">
                  <div>
                    <label for="contactEmail" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“§ Email *</label>
                    <input type="email" id="contactEmail" name="contactEmail" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                  </div>
                  <div>
                    <label for="contactPhone" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“± Telefono</label>
                    <input type="tel" id="contactPhone" name="contactPhone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                  </div>
                </div>
              </div>

              <div class="border-t border-gray-600 pt-6">
                <h3 class="text-xl font-bold text-white mb-4 editing-enabled" data-key="details-title">ğŸ“Š Dettagli del Progetto</h3>
                <div class="grid md:grid-cols-2 gap-6">
                  <div>
                    <label for="studentsNumber" class="block text-sm font-medium text-gray-300 mb-2">ğŸ‘¥ Numero Studenti *</label>
                    <select id="studentsNumber" name="studentsNumber" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                      <option value="">Seleziona numero</option>
                      <option value="10-20">10â€“20</option>
                      <option value="21-30">21â€“30</option>
                      <option value="31-50">31â€“50</option>
                      <option value="50+">PiÃ¹ di 50</option>
                    </select>
                  </div>
                  <div>
                    <label for="classYear" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“ Anno Scolastico *</label>
                    <select id="classYear" name="classYear" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                      <option value="">Seleziona anno</option>
                      <option value="terzo">Terzo</option>
                      <option value="quarto">Quarto</option>
                      <option value="quinto">Quinto</option>
                      <option value="misto">Classi Miste</option>
                    </select>
                  </div>
                </div>
                <div class="mt-6">
                  <label for="projectPeriod" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“… Periodo Preferito *</label>
                  <select id="projectPeriod" name="projectPeriod" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <option value="">Seleziona periodo</option>
                    <option value="ottobre-dicembre">Ottobre â€“ Dicembre</option>
                    <option value="gennaio-marzo">Gennaio â€“ Marzo</option>
                    <option value="aprile-giugno">Aprile â€“ Giugno</option>
                    <option value="flessibile">Flessibile</option>
                  </select>
                </div>
              </div>

              <div class="border-t border-gray-600 pt-6">
                <label for="motivation" class="block text-sm font-medium text-gray-300 mb-2">ğŸ’­ Motivazioni e Aspettative *</label>
                <textarea id="motivation" name="motivation" rows="4" required placeholder="PerchÃ© siete interessati al progetto e cosa vi aspettate..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"></textarea>
              </div>

              <div class="border-t border-gray-600 pt-6">
                <label class="flex items-start space-x-3 text-gray-300">
                  <input type="checkbox" id="privacy" name="privacy" required class="w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500 mt-1" />
                  <span class="text-sm">Accetto il trattamento dei dati personali (GDPR) per le finalitÃ  del progetto PCTO *</span>
                </label>
              </div>

              <div class="text-center pt-6">
                <button type="submit" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-12 py-4 rounded-full text-lg font-semibold hover-lift neon-glow">ğŸš€ Invia Candidatura</button>
              </div>
            </form>
          </div>

          <div class="mt-12 grid md:grid-cols-2 gap-8">
            <div class="bg-gradient-to-br from-blue-900 to-indigo-900 p-6 rounded-xl">
              <h3 class="text-xl font-bold text-white mb-4 editing-enabled" data-key="proc-title">ğŸ“‹ Processo di Selezione</h3>
              <ul class="space-y-2 text-gray-300 text-sm">
                <li class="editing-enabled" data-key="proc-1">â€¢ Valutazione candidature entro 15 giorni</li>
                <li class="editing-enabled" data-key="proc-2">â€¢ Colloquio conoscitivo con il referente</li>
                <li class="editing-enabled" data-key="proc-3">â€¢ Definizione calendario e modalitÃ </li>
                <li class="editing-enabled" data-key="proc-4">â€¢ Avvio del progetto</li>
              </ul>
            </div>
            <div class="bg-gradient-to-br from-green-900 to-teal-900 p-6 rounded-xl">
              <h3 class="text-xl font-bold text-white mb-4 editing-enabled" data-key="contatti-title">ğŸ“ Contatti</h3>
              <div class="space-y-2 text-gray-300 text-sm">
                <p class="editing-enabled" data-key="contact-email">ğŸ“§ Email: pcto@aeroclubao.it</p>
                <p class="editing-enabled" data-key="contact-phone">ğŸ“± Telefono: +39 0165 123456</p>
                <p class="editing-enabled" data-key="contact-site">ğŸŒ Sito: www.aeroclubao.it</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- (other sections remain as previously provided) -->

  </main>

  <script>
    // ===== Navegazione a sezioni (hash + data-page) =====
    function setActivePage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById(id) || document.getElementById('home');
      page.classList.add('active');
      document.querySelectorAll('.nav-link').forEach(a => {
        a.classList.toggle('active', a.getAttribute('data-page') === id);
      });
      // Aggiorna hash senza scroll brusco
      if (location.hash !== '#' + id) history.replaceState(null, '', '#' + id);

      // Mostra la toolbar solo nella pagina "webmaster"
      const toolbar = document.getElementById('toolbarActions');
      if (toolbar) toolbar.classList.toggle('hidden', id !== 'webmaster');
    }

    function initNav() {
      document.querySelectorAll('.nav-link').forEach(a => {
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const id = a.getAttribute('data-page');
          setActivePage(id);
          // chiudi mobile
          const mm = document.getElementById('mobileMenu');
          mm.classList.remove('open');
          mm.setAttribute('aria-hidden','true');
        });
      });
      // hash iniziale
      const start = (location.hash || '#home').replace('#','');
      setActivePage(start);
    }

    // ===== Mobile menu =====
    function initMobileMenu(){
      const btn = document.getElementById('mobileMenuBtn');
      const menu = document.getElementById('mobileMenu');
      btn.addEventListener('click', ()=>{
        const open = menu.classList.toggle('open');
        menu.setAttribute('aria-hidden', String(!open));
      });
    }

    // ===== Editing in-place + material link editing =====
    let editing = false;
    function applyEditable(enabled){
      const nodes = document.querySelectorAll('.editing-enabled');
      nodes.forEach(n => {
        const tag = n.tagName.toLowerCase();
        const forbidden = ['a','button','input','select','textarea','svg','iframe'];
        if (forbidden.includes(tag)) return;
        if (enabled) {
          n.setAttribute('contenteditable','true');
        } else {
          n.removeAttribute('contenteditable');
        }
      });
      const banner = document.getElementById('editBanner');
      if (banner) banner.classList.toggle('hidden', !enabled);

      // Toggle visibility of editing-only controls (inputs for material links)
      document.querySelectorAll('.editing-controls').forEach(ctrl => {
        ctrl.classList.toggle('visible', Boolean(enabled));
      });
    }

    function initEditingToolbar(){
      const toggle = document.getElementById('toggleEdit');
      const save = document.getElementById('saveEdits');
      const clear = document.getElementById('clearEdits');

      // Costanti per proteggere l'attivazione del editing
      const EDIT_CODE = 'ACAO-Edit-2025';   // <--- cambia qui il codice desiderato
      const EDIT_KEY  = 'pctosite_editor';  // chiave sessionStorage per ricordare lo sblocco

      // Helper: controlla se la sessione Ã¨ sbloccata
      function isUnlocked(){ return sessionStorage.getItem(EDIT_KEY) === '1'; }

      // Click sul toggle: se non sbloccato chiedi il codice, altrimenti toggle normale
      if (toggle) {
        toggle.addEventListener('click', ()=> {
          if (!isUnlocked()) {
            const code = prompt('Inserisci il codice per attivare la ModalitÃ  Editing:');
            if (code === null) return; // annullato
            if (code !== EDIT_CODE) { alert('Codice errato'); return; }
            sessionStorage.setItem(EDIT_KEY, '1');
          }
          // se siamo qui la sessione Ã¨ sbloccata: toggle editing
          editing = !editing;
          applyEditable(editing);
        });
      }

      // Salva i testi editati per data-key in localStorage
      if (save) save.addEventListener('click', ()=>{
        const data = {};
        document.querySelectorAll('.editing-enabled[data-key]').forEach(el=>{
          data[el.getAttribute('data-key')] = el.innerHTML.trim();
        });
        localStorage.setItem('pctosite_edits', JSON.stringify(data));
        alert('Contenuti salvati nel browser.');
      });

      if (clear) clear.addEventListener('click', ()=>{
        if (confirm('Ripristinare i testi originali?')){
          localStorage.removeItem('pctosite_edits');
          location.reload();
        }
      });

      // Carica se presenti (testi)
      const saved = localStorage.getItem('pctosite_edits');
      if (saved){
        try{
          const data = JSON.parse(saved);
          Object.entries(data).forEach(([k,v])=>{
            const el = document.querySelector(`[data-key="${k}"]`);
            if (el) el.innerHTML = v;
          });
        }catch(e){ console.warn('Salvataggio non valido'); }
      }
    }

    // ===== Material links storage & helpers =====
    const MATERIALS_KEY = 'pctosite_material_links';

    // Converti un Google Drive share link in direct download quando possibile
    function driveShareToDirect(url) {
      if (!url) return url;
      // estrai fileId dai possibili formati
      const re1 = /\/d\/([a-zA-Z0-9_-]+)/;
      const re2 = /id=([a-zA-Z0-9_-]+)/;
      let m = url.match(re1);
      if (!m) m = url.match(re2);
      if (m && m[1]) {
        return 'https://drive.google.com/uc?export=download&id=' + m[1];
      }
      // Dropbox tweak
      if (url.includes('dropbox.com')) {
        return url.replace('?dl=0','?dl=1');
      }
      return url;
    }

    function loadMaterialLinks(){
      try {
        const raw = localStorage.getItem(MATERIALS_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch(e){ return {}; }
    }
    function saveMaterialLinks(obj){
      localStorage.setItem(MATERIALS_KEY, JSON.stringify(obj));
    }
    function setMaterialLink(key, url){
      const obj = loadMaterialLinks();
      if (!url) {
        delete obj[key];
      } else {
        obj[key] = url;
      }
      saveMaterialLinks(obj);
      applyMaterialLinkToDOM(key, url);
    }
    function applyMaterialLinkToDOM(key, url){
      const anchor = document.getElementById(key + '-download') || document.querySelector(`[data-material="${key}"] .material-download`);
      if (!anchor) return;
      if (url) {
        anchor.href = url;
        anchor.setAttribute('target','_blank');
        anchor.setAttribute('rel','noopener');
      } else {
        // restore to default local file if you have a default mapping
        const defaults = {
          'm1': 'files/manuale-aerodinamica.pdf',
          'm2': 'files/calcoli-volo.xlsx',
          'm3': 'files/video-lezioni.zip'
        };
        if (defaults[key]) {
          anchor.href = defaults[key];
          anchor.removeAttribute('target');
          anchor.removeAttribute('rel');
        } else {
          anchor.removeAttribute('href');
        }
      }
    }

    function applyAllMaterialLinks(){
      const obj = loadMaterialLinks();
      ['m1','m2','m3'].forEach(k => {
        const url = obj[k];
        if (url) applyMaterialLinkToDOM(k, url);
      });
      // populate input fields (if editing)
      Object.entries(loadMaterialLinks()).forEach(([k,v])=>{
        const input = document.getElementById(k + '-url');
        if (input) input.value = v;
      });
    }

    // Handler for save/clear buttons in material controls
    function initMaterialControls(){
      document.querySelectorAll('[data-action="save-link"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const key = btn.getAttribute('data-material');
          const input = document.getElementById(key + '-url');
          if (!input) return;
          let raw = input.value.trim();
          if (!raw) return alert('Inserisci un URL valido');
          const direct = driveShareToDirect(raw);
          setMaterialLink(key, direct);
          alert('Link salvato per ' + key);
        });
      });
      document.querySelectorAll('[data-action="clear-link"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const key = btn.getAttribute('data-material');
          const input = document.getElementById(key + '-url');
          if (input) input.value = '';
          setMaterialLink(key, null);
          alert('Link rimosso per ' + key);
        });
      });
    }

    // ===== Communications subscribe (local demo) =====
    function initCommunications(){
      const btn = document.getElementById('commSubscribe');
      const emailInput = document.getElementById('commEmail');
      const feedback = document.getElementById('commFeedback');
      btn?.addEventListener('click', ()=>{
        const email = emailInput.value.trim();
        if (!email || !email.includes('@')) return alert('Inserisci una email valida');
        let list = [];
        try { list = JSON.parse(localStorage.getItem('pctosite_subscribers') || '[]'); } catch(e){ list = []; }
        if (!list.includes(email)) {
          list.push(email);
          localStorage.setItem('pctosite_subscribers', JSON.stringify(list));
        }
        feedback.textContent = 'Grazie â€” email salvata localmente (demo).';
        feedback.classList.remove('hidden');
        setTimeout(()=> feedback.classList.add('hidden'), 4000);
      });
    }

    // ===== Lightbox Media =====
    function initLightbox(){
      const lb = document.getElementById('lightbox');
      const lbImg = document.getElementById('lightboxImg');
      document.querySelectorAll('#mediaGrid img').forEach(img=>{
        img.addEventListener('click', ()=>{
          lbImg.src = img.getAttribute('data-full') || img.src;
          lb.classList.remove('hidden');
          lb.classList.add('flex');
        });
      });
      if (lb) {
        lb.addEventListener('click', ()=>{
          lb.classList.add('hidden');
          lb.classList.remove('flex');
          const lbImg = document.getElementById('lightboxImg');
          if (lbImg) lbImg.src = '';
        });
        document.addEventListener('keydown', (e)=>{ if (e.key==='Escape') lb.click(); });
      }
    }

    // ===== Inizializza =====
    document.addEventListener('DOMContentLoaded', ()=>{
      initNav();
      initMobileMenu();
      initEditingToolbar();
      applyEditable(false); // parte non in editing
      initLightbox();

      // material controls
      initMaterialControls();
      applyAllMaterialLinks();

      // communications
      initCommunications();

      // All'avvio: la toolbar deve essere visibile SOLO se la pagina iniziale Ã¨ webmaster
      const start = (location.hash || '#home').replace('#','');
      const toolbar = document.getElementById('toolbarActions');
      if (toolbar) toolbar.classList.toggle('hidden', start !== 'webmaster');
    });
  </script>
</body>
</html>
